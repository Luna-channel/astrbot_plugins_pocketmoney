# 小金库插件 (PocketMoney)

贝塔的小金库系统，一个为AstrBot设计的全局资金管理插件。

## 功能特点

- **全局余额管理**：不区分会话，所有窗口共享同一个钱包
- **入账控制**：只有管理员（奥卢斯大人）可以通过指令入账
- **AI自主出账**：AI可以在对话中自主决定花钱
- **交易记录**：保存完整的入账/出账记录
- **上下文注入**：自动将小金库状态注入到对话上下文中
- **表扬信系统**：用户发送表扬信可获得随机奖金（每人每天一次）
- **投诉信系统**：用户可发送投诉信，自动转发给管理员（含来源窗口信息）
- **小背包系统**：AI可自主管理私人物品，存取东西

## 管理员指令

| 指令 | 说明 | 示例 |
|------|------|------|
| `发零花钱 <金额> [原因]` | 入账 | `发零花钱 200 每周零花钱` |
| `扣零花钱 <金额> [原因]` | 扣款 | `扣零花钱 50 罚款` |
| `设置余额 <金额> [原因]` | 直接设置余额 | `设置余额 1000 初始化` |
| `查账` | 查看余额和最近记录 | `查账` |
| `查流水 [数量]` | 查看交易流水 | `查流水 20` |
| `清空流水` | 清空交易记录（保留余额） | `清空流水` |
| `查看背包` | 查看贝塔的小背包 | `查看背包` |
| `清空背包` | 清空小背包所有物品 | `清空背包` |
| `背包移除 <物品名>` | 移除指定物品 | `背包移除 小蛋糕` |

## 用户指令

| 指令 | 说明 | 示例 |
|------|------|------|
| `发表扬信` | 发送表扬信获得随机奖金（每天一次） | `发表扬信` |
| `发投诉信 [理由]` | 发送投诉信给管理员 | `发投诉信 贝塔不理我` |
| `表扬信排行 [数量]` | 查看表扬信排行榜 | `表扬信排行 10` |
| `今日表扬` | 查看今日表扬奖金统计 | `今日表扬` |
| `零花钱日` | 查看距离发零花钱还有几天 | `零花钱日` |

## AI自动标记

### 出账标记
当AI决定花钱时，会在回复末尾添加：
```
[Spend: 50, Reason: 请群友喝奶茶]
```

### 背包入库标记
当AI给自己买了东西时，会在回复末尾添加：
```
[Store: 小蛋糕, Desc: 草莓味的，留着饿了吃]
```

### 背包使用标记
当AI想用掉背包里的东西时，会在回复末尾添加：
```
[Use: 小蛋糕]
```

插件会自动解析并执行相应操作，同时从回复中移除这些标记。

## 配置项

在AstrBot管理面板中可配置：

- **initial_balance**: 初始余额（默认0）
- **max_backpack_slots**: 背包格子上限（默认10）
- **thank_letter_min_amount**: 表扬信最小奖金（默认1）
- **thank_letter_max_amount**: 表扬信最大奖金（默认10）
- **admin_qq**: 管理员QQ号（投诉信转发目标）
- **admin_permission_denied_msg**: 非管理员权限提示
- **max_records**: 最大记录条数（默认100）
- **income_record_count**: 注入提示词的入账记录条数
- **expense_record_count**: 注入提示词的出账记录条数
- **allowance_day**: 发零花钱的星期（1-7）
- **context_prompt_template**: 上下文提示词模板
- **spending_instruction**: 出账指令提示词
- **backpack_instruction**: 背包提示词模板
- **debug_log_level**: 日志级别

## 数据存储

插件数据存储在 `data/PocketMoney/` 目录下：
- `pocket_money.json` - 余额和交易记录
- `thank_letters.json` - 表扬信数据和排行榜
- `backpack.json` - 小背包物品

## 安装

将插件文件夹放入AstrBot的plugins目录，重启AstrBot即可。

## 作者

柯尔
